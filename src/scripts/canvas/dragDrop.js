// ===== DRAG & DROP SYSTEM =====
// Not ve klas√∂r s√ºr√ºkleme i≈ülemleri

// Klas√∂rleri droppable yap (notlarƒ± kabul edebilir)
function makeFolderDroppable(folderElement, folderId) {
  const state = window.getState();
  
  // Drag over - not √ºzerine geldiƒüinde
  folderElement.addEventListener('dragover', (e) => {
    e.preventDefault();
    e.dataTransfer.dropEffect = 'move';
    
    // G√∂rsel geri bildirim
    folderElement.style.backgroundColor = 'rgba(125, 211, 252, 0.1)';
    folderElement.style.border = '2px dashed rgba(125, 211, 252, 0.5)';
  });
  
  // Drag leave - not √ºzerinden √ßƒ±ktƒ±ƒüƒ±nda
  folderElement.addEventListener('dragleave', (e) => {
    // Sadece klas√∂r√ºn dƒ±≈üƒ±na √ßƒ±kƒ±ldƒ±ƒüƒ±nda temizle
    if (!folderElement.contains(e.relatedTarget)) {
      folderElement.style.backgroundColor = '';
      folderElement.style.border = '';
    }
  });
  
  // Drop - not bƒ±rakƒ±ldƒ±ƒüƒ±nda
  folderElement.addEventListener('drop', (e) => {
    e.preventDefault();
    
    // G√∂rsel geri bildirimi temizle
    folderElement.style.backgroundColor = '';
    folderElement.style.border = '';
    
    if (state.draggedNoteId) {
      console.log(`üìÅ Not ${state.draggedNoteId} klas√∂re ta≈üƒ±nƒ±yor: ${folderId || 'klas√∂rs√ºz'}`);
      
      // G√∂rsel geri bildirim
      const noteTitle = window.getNoteById ? window.getNoteById(state.draggedNoteId)?.title : 'Bilinmeyen';
      if (window.showNotification) {
        window.showNotification(`Not "${noteTitle}" ta≈üƒ±nƒ±yor...`, 'info');
      }
      
      // Notu ta≈üƒ±
      if (window.changeNoteFolder) {
        window.changeNoteFolder(state.draggedNoteId, folderId);
      }
      
      // Not y√∂netim panelini hemen g√ºncelle (asenkron i≈ülem i√ßin)
      setTimeout(() => {
        if (window.renderFolderList) window.renderFolderList();
        if (window.renderNotes) window.renderNotes();
      }, 100);
      
      // Drag state'i temizle
      state.draggedNoteId = null;
      state.draggedElement = null;
      window.setState(state);
    }
  });
}

// Sidebar'daki notlarƒ± draggable yap
function makeNoteDraggable(noteElement, noteId) {
  noteElement.draggable = true;
  const state = window.getState();
  
  noteElement.addEventListener('dragstart', (e) => {
    state.draggedNoteId = noteId;
    state.draggedElement = noteElement;
    window.setState(state);
    
    // Drag g√∂rselini √∂zelle≈ütir
    e.dataTransfer.effectAllowed = 'move';
    e.dataTransfer.setData('text/plain', noteId);
    
    // G√∂rsel geri bildirim
    noteElement.style.opacity = '0.7';
    noteElement.style.transform = 'rotate(2deg)';
    
    console.log('üìÅ Drag ba≈üladƒ±:', noteId);
  });
  
  noteElement.addEventListener('dragend', (e) => {
    // G√∂rsel geri bildirimi temizle
    noteElement.style.opacity = '';
    noteElement.style.transform = '';
    
    // T√ºm klas√∂rlerin g√∂rsel geri bildirimini temizle
    document.querySelectorAll('.folder-item').forEach(folder => {
      folder.style.backgroundColor = '';
      folder.style.border = '';
    });
    
    console.log('üìÅ Drag bitti');
    
    // Drag state'i temizle
    const state = window.getState();
    state.draggedNoteId = null;
    state.draggedElement = null;
    window.setState(state);
  });
  
  // Context menu ekle
  noteElement.addEventListener('contextmenu', (e) => {
    e.preventDefault();
    if (window.showNoteContextMenu) {
      window.showNoteContextMenu(e, noteId);
    }
  });
}

// Global exports
window.makeFolderDroppable = makeFolderDroppable;
window.makeNoteDraggable = makeNoteDraggable;

console.log('üñ±Ô∏è Drag & Drop System y√ºklendi');

